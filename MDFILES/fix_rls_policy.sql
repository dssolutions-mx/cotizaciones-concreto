-- Add RLS policy for ensayos table to allow proper permissions ALTER TABLE ensayos ENABLE ROW LEVEL SECURITY; -- Drop existing policies if needed DROP POLICY IF EXISTS "Users can insert ensayos" ON ensayos; DROP POLICY IF EXISTS "Users can view their own ensayos" ON ensayos; -- Allow users to create ensayos CREATE POLICY "Users can insert ensayos" ON ensayos FOR INSERT TO authenticated WITH CHECK (auth.uid() = created_by); -- Allow users to view their own ensayos or ensayos associated with their muestreos CREATE POLICY "Users can view their own ensayos" ON ensayos FOR SELECT TO authenticated USING (auth.uid() = created_by OR auth.uid() IN (SELECT created_by FROM muestreos WHERE id = muestreo_id));
