# Recovery Guide for Order ORD-20260128-7243

## ðŸš€ Quick Start (First Time with Docker?)

**New to Docker?** See **[QUICK_START_DOCKER.md](QUICK_START_DOCKER.md)** for beginner-friendly instructions!

## Quick Start

Since backups don't appear in the Supabase dashboard, we'll use Docker to connect directly to the production database and recover the order.

### Automated Recovery (Recommended)

```bash
# Run the complete Docker recovery script
./scripts/recover-ORD-20260128-7243-docker.sh
```

This script will:
1. Ask for your Supabase database connection string
2. Search for order traces in production database
3. Attempt to extract the order
4. Optionally create a database dump for deeper search
5. Export all findings to `recovery-exports/`

### Manual Steps

#### Step 1: Get Database Connection String

1. Go to: https://supabase.com/dashboard/project/pkjqznogflgbnwzkzmpg
2. Navigate to: **Project Settings â†’ Database â†’ Connection string**
3. Copy the **URI** connection string
4. Format: `postgresql://postgres.[ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres`

#### Step 2: Search for Order Traces

```bash
# Start recovery database
docker-compose -f docker/recovery-docker-compose.yml up -d

# Search production database for traces
docker run --rm -i postgres:15 psql "<connection_string>" -f scripts/find-order-ORD-20260128-7243.sql > recovery-exports/traces.txt
```

#### Step 3: Review Results

Check `recovery-exports/traces.txt` for:
- `order_id` (UUID) if found in `order_notifications`
- Related records in `order_history`, `quotes`, `remisiones`
- Any references that can help identify the order

#### Step 4: Extract Order (if found)

```bash
# Try direct extraction
docker run --rm -i postgres:15 psql "<connection_string>" -f scripts/extract-order-ORD-20260128-7243.sql > recovery-exports/extracted-order.json
```

#### Step 5: Create Dump and Search (if direct extraction fails)

```bash
# Create database dump
docker run --rm -i postgres:15 pg_dump "<connection_string>" > recovery-backups/production-dump.sql

# Restore to local database
docker exec -i order-recovery-db psql -U postgres -d recovery_db < recovery-backups/production-dump.sql

# Search restored database
docker cp scripts/find-order-ORD-20260128-7243.sql order-recovery-db:/tmp/
docker exec -i order-recovery-db psql -U postgres -d recovery_db -f /tmp/find-order-ORD-20260128-7243.sql > recovery-exports/restored-traces.txt

# Extract from restored database
docker cp scripts/extract-order-ORD-20260128-7243.sql order-recovery-db:/tmp/
docker exec -i order-recovery-db psql -U postgres -d recovery_db -f /tmp/extract-order-ORD-20260128-7243.sql > recovery-exports/extracted-from-dump.json
```

## What We're Looking For

The investigation queries will search:

1. **order_notifications** - May contain order_id and notification details
2. **order_history** - Legacy table may have order record
3. **quotes** - If order was created from quote, quote details exist
4. **remisiones** - If order had remisiones, they may still reference order_id
5. **order_site_validations** - Site validation records
6. **order_additional_products** - Additional products linked to order

## Expected Results

### If Order Found
- Complete order data with all order_items
- Client information
- Related notifications and validations
- Export to JSON/CSV for evidence

### If Order Not Found
- Traces in related tables (notifications, quotes, etc.)
- Order_id UUID that can be used to reconstruct
- Timestamps and user information
- Enough data to reconstruct the order

## Troubleshooting

### Connection Issues
- Verify connection string format
- Try connection pooler port (6543) vs direct port (5432)
- Check if IP whitelisting is required in Supabase Dashboard

### No Traces Found
- Order may have been deleted before any records were created
- Check Supabase logs: Database â†’ Logs â†’ Postgres Logs
- Search for DELETE statements around Feb 3-4, 2026
- Contact Supabase support for backup access

### Docker Issues
- Ensure Docker is running: `docker ps`
- Check container status: `docker-compose -f docker/recovery-docker-compose.yml ps`
- View logs: `docker-compose -f docker/recovery-docker-compose.yml logs`

## Files Created

- `scripts/find-order-ORD-20260128-7243.sql` - Investigation queries
- `scripts/extract-order-ORD-20260128-7243.sql` - Extraction queries
- `scripts/recover-ORD-20260128-7243-docker.sh` - Automated recovery script
- `scripts/recover-ORD-20260128-7243-DOCKER.md` - Detailed Docker guide

## Next Steps After Recovery

1. **Verify Data**: Check that recovered order matches known details
2. **Export Evidence**: Save to JSON/CSV formats
3. **Document Process**: Keep records for legal purposes
4. **Preserve**: Create backup copies of recovered data

## Support

If recovery fails:
1. Contact Supabase support: https://supabase.com/support
2. Request backup access for Jan 28 - Feb 3, 2026
3. Explain situation (deleted order, evidence needed)
4. They may provide backup access or restore from archives
